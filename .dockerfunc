composer() {
  docker run \
  --rm \
  -u $(id -u):$(id -g) \
  -v $(pwd):/app \
  composer/composer \
  $@
}
yarn() {
  docker run \
  --rm \
  -u "node" \
  -w "/home/node/app" \
  -v "$(pwd):/home/node/app" \
  node yarn \
  $@
}
node() {
  docker run \
  --rm \
  -u "node" \
  -w "/home/node/app" \
  -v "$(pwd):/home/node/app" \
  node node \
  $@
}

npm() {
  docker run \
  --rm \
  -u "node" \
  -w "/home/node/app" \
  -v "$(pwd):/home/node/app" \
  node npm \
  $@
}

swp_test() {
  local sitename="${1:-worpress_multisite}"
  echo $sitename
}


wordpress_multisite() {
  # setup wordpress multisite
  #mysql
  #phpadmin
  local sitename="${1:-wordpress_multisite}"
  echo "Creating docker contaner: ${sitename}"
  docker run \
  --name ${sitename} \
  -v ${HOME}/Docker/wordpress/${sitename}/wp-content:/var/www/html/wp-content \
  -e WORDPRESS_DB_HOST="mysql57:3306" \
  -e WORDPRESS_DB_PASSWORD="r@nD0m7772" \
  -e WORDPRESS_MULTISITE="true" \
  -e WORDPRESS_DB_NAME="${sitename}" \
  -e WORDPRESS_DEBUG="true" \
  -e WORDPRESS_DOMAIN="wp.gov.com" \
  -e WP_GROUP=$(id -g) \
  -e VIRTUAL_HOST="wp.gov.com" \
  --link mysql57:mysql \
  --restart=unless-stopped \
  -u :$(id -g) \
  -d \
  sturple/wordpress
}

mysql() {
  docker run \
  --name mysql57 \
  -v ${HOME}/appdata/.mysql:/var/lib/mysql \
  -e MYSQL_ROOT_PASSWORD="r@nD0m7772" \
  --restart always \
  -d \
  mysql:5.7 \
  $@
}

phpmyadmin() {
  docker run \
  --name phpmyadmin \
  -e MYSQL_ROOT_PASSWORD="r@nD0m7772" \
  -e PMA_HOST="mysql57" \
  -e VIRTUAL_HOST="phpmyadmin.gov.com" \
  --link mysql57:mysql \
  --add-host="phpmyadmin.gov.com:172.17.0.4" \
  -p 8080:80 \
  --restart always \
  -d \
  phpmyadmin/phpmyadmin \
  $@
}

rev_proxy() {
  docker run \
  --name rev_proxy \
  -d \
  -p 80:80 \
  -v /var/run/docker.sock:/tmp/docker.sock:ro  \
  -e DEFAULT_HOST=gov.com \
  jwilder/nginx-proxy \
  $@
}

update_hosts() {
  #usage update_hosts /etc/hosts
  local processFile="${1-/etc/hosts}"
  local tmpfile=${processFile}.tmp
  for service in $(docker ps -q) ; do
    local domain="";
    for vh in $(docker inspect --format '{{ .Config.Env }}' ${service} | egrep -oh 'VIRTUAL_HOST=(\w|\.)+' | tr "=" "\n") ; do
      if [ $vh != 'VIRTUAL_HOST' ]; then
        domain="${vh}"
      fi
    done
    if [ -n "${domain}" ]; then
      local ipaddress=$(docker inspect --format '{{ .NetworkSettings.IPAddress }}' ${service})
      grep -v $domain $processfile > $tmpfile
      echo -e "${ipaddress} \t ${domain}" >> $tmpfile
    fi
  done
}
